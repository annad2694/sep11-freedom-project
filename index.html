<!DOCTYPE html>
<html>
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
        <link href="style.css" rel="stylesheet" type="text/css" />
        <style>
            /* CSS */

        </style>

        <title>Title</title>
    </head>
    <body>
        <!-- HTML -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Simon Says with Twist</title>
</head>
<body>
<script src="https://unpkg.com/kaboom@3000.0.1/dist/kaboom.js"></script>
<script>
kaboom({ background: [20,20,30] });

// BUTTON SETUP
const colors = ["red","green","blue","yellow"];
const positions = [vec2(200,150), vec2(400,150), vec2(200,300), vec2(400,300)];

const buttons = colors.map((color,i)=>{
  const btn = add([rect(100,100), pos(positions[i]), area(), anchor("center"), { colorName: color }]);
  if(color==="red") btn.color = rgb(255,0,0);
  if(color==="green") btn.color = rgb(0,255,0);
  if(color==="blue") btn.color = rgb(0,0,255);
  if(color==="yellow") btn.color = rgb(255,255,0);
  return btn;
});

// GAME STATE
let pattern = [];
let playerInput = [];
let canClick = false;
let messageEntity = null;
let simonSaysRound = true;
let clickTimeout = null;

// FLASH FUNCTION
function flashButton(btn){
  const orig = btn.color.clone();
  btn.color = rgb(255,255,255); // flash white
  wait(0.4, ()=> btn.color = orig);
}

// SHOW MESSAGE (manual control)
function showMessage(msg, size=32){
  if(messageEntity) destroy(messageEntity);
  messageEntity = add([text(msg,{size}), pos(width()/2,50), anchor("center")]);
}

function hideMessage(){
  if(messageEntity){
    destroy(messageEntity);
    messageEntity = null;
  }
}

// PLAY PATTERN
async function playPattern(){
  canClick = false;

  // Decide round type before flashing
  simonSaysRound = Math.random() < 0.7; // 70% Simon says click
  showMessage(simonSaysRound ? "Simon says click!" : "Don't click!");

  // Flash the sequence
  for(const color of pattern){
    const btn = buttons.find(b=>b.colorName===color);
    flashButton(btn);
    await new Promise(r => setTimeout(r, 600));
  }

  // Sequence done → hide message
  hideMessage();

  // Enable player input
  canClick = true;

  // Set 3-second timer if "Don't click!" round
  if(!simonSaysRound){
    clickTimeout = wait(3, ()=>{
      clickTimeout = null;
      showMessage("✅ Correct! (You didn't click)",32);
      nextRound();
    });
  }
}

// NEXT ROUND
function nextRound(){
  playerInput=[];
  if(pattern.length===0){
    pattern.push(choose(colors));
  } else if(simonSaysRound){
    pattern.push(choose(colors)); // grow sequence
  } else {
    pattern = [choose(colors)]; // reset after Don't click
  }
  playPattern();
}

// BUTTON CLICK HANDLER
buttons.forEach(btn=>{
  btn.onClick(()=>{
    if(!canClick) return;

    // Player clicked during "Don't click!" → fail
    if(!simonSaysRound){
      if(clickTimeout){
        clickTimeout.cancel();
        clickTimeout = null;
      }
      showMessage("❌ You clicked when you shouldn't!", 32);
      pattern = [];
      wait(1,nextRound);
      return;
    }

    // Normal Simon says round
    playerInput.push(btn.colorName);
    flashButton(btn);

    const idx = playerInput.length -1;
    if(playerInput[idx] !== pattern[idx]){
      showMessage("❌ Wrong!", 48);
      pattern = [];
      wait(1,nextRound);
      return;
    }

    if(playerInput.length === pattern.length){
      showMessage("✅ Correct!",48);
      wait(1,nextRound);
    }
  });
});

// START GAME
pattern=[choose(colors)];
playPattern();
</script>
</body>
</html>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
        <!-- <script src="script.js"></script> -->
        <script>
            // JS


        </script>
    </body>
</html>
